# 2025-08-13 å­¸ç¿’æ—¥èªŒ

- [x] debug nvim startup issues - markview.lua å’§ä½œå­½
- [x] markview blockquote æœƒä½¿è¨­ä¸ªæ¨™ç±¤çœŸæ¿Ÿ
- [x] null-ls mystic error - selene å’§è¨è¨­å®šæª”
- [x] selene æ„›æœ‰è¨­å®šæª”ä½‡å°ˆæ¡ˆæ ¹ç›®éŒ„
- [x] é‡æ•´ nvim config folders ä½® aliases
- [x] markdown folding ç„¡å•¥æœƒæ›‰ï¼Œå¹²ç„¦é  TS ç„¡å¤ ä¸ªæ¬¾ï¼ŒåŠ è£ Markdown-oxide LSP
- [x] nvim-ts-autotags é‡å° markdown é—œèµ·ä¾†

## debug nvim startup warning about runtime path

> [!WARNING]
> This can cause syntax highlighting issues! Your runtime path has been modified
> to fix load order. You can disable this by setting experimental.check_rtp =
> false or set experimental.check_rtp_message = false to only hide this message.

### AI try snip 1

```shell
# `nvim -es` means "Silent (non-interactive) Ex mode, reading stdin as Ex
#   commands.  Useful for scripting because it does NOT start a UI, unlike -e.
#   see :help silent-mode
echo -e ':redir > /tmp/lazy_profile.txt\n:Lazy profile\n:redir END\n:redir > /tmp/lazy_log.txt\n:Lazy log\n:redir END\n:redir > /tmp/lazy_doctor.txt\n:Lazy doctor\n:redir END\n:qa!' | nvim -u ~/.config/nvim-as1/init.lua -es 2>&1
```

### AI try snip 2

```shell
nvim --headless -u ~/.config/nvim-as1/init.lua +'Lazy profile' +qa 2>&1 | tee /tmp/lazy_profile_output.txt
```

NOTE: `:Lazy profile` ç„¡å³ä¸ªæŒ‡ä»¤ã€‚

### æˆ‘å®¶å·±è§£æ±ºçŸ£

ä½‡ commumity.lua éå°‡
`{ import = "astrocommunity.markdown-and-latex.markview-nvim" },`
åŠ å…¥ä¾†å°±è‘—çŸ£ï¼ŒæŒ‰å‘¢ plugins/markvew.lua å°±è¢‚é–£ç‹¡æ€ªçŸ£ã€‚

é ­å‰è¿„ä¸ªè­¦å‘Šè¨Šæ¯æ‰€æèµ·ä¸ª `experimental.check_rtp = false`
`experimental.check_rtp.message = false` æ˜¯å° markview.nvim å…§åº•å‡ºä¾†ä¸ªå•¦ï¼ä½‡é®
`~/.local/share/nvim-as2/lazy/markview.nvim/lua/markview/spec.lua` æœ‰ã€‚

éé ­ä¾è³´ AI å·²ç¶“æ¸›ææˆ‘ä¸ªèª¿æŸ¥åŠ›ï¼

## markview blockquote æœƒä½¿è¨­ä¸ªæ¨™ç±¤

```lua
    block_quotes = {
      enable = true,
      wrap = true,

      default = {
        border = "â–‹",
        hl = "MarkviewBlockQuoteDefault"
      },

      ["ABSTRACT"] = {
        preview = "ó±‰« Abstract",
        hl = "MarkviewBlockQuoteNote",

        title = true,
        icon = "ó±‰«",
      },
      ["SUMMARY"] = {
        hl = "MarkviewBlockQuoteNote",
        preview = "ó±‰« Summary",

        title = true,
        icon = "ó±‰«",
      },
      ["TLDR"] = {
        hl = "MarkviewBlockQuoteNote",
        preview = "ó±‰« Tldr",

        title = true,
        icon = "ó±‰«",
      },
      ["TODO"] = {
        hl = "MarkviewBlockQuoteNote",
        preview = "îšœ Todo",

        title = true,
        icon = "îšœ",
      },
      ["INFO"] = {
        hl = "MarkviewBlockQuoteNote",
        preview = "î™ª Info",

        custom_title = true,
        icon = "îšœ",
      },
      ["SUCCESS"] = {
        hl = "MarkviewBlockQuoteOk",
        preview = "ó°—  Success",

        title = true,
        icon = "ó°— ",
      },
      ["CHECK"] = {
        hl = "MarkviewBlockQuoteOk",
        preview = "ó°—  Check",

        title = true,
        icon = "ó°— ",
      },
      ["DONE"] = {
        hl = "MarkviewBlockQuoteOk",
        preview = "ó°—  Done",

        title = true,
        icon = "ó°— ",
      },
      ["QUESTION"] = {
        hl = "MarkviewBlockQuoteWarn",
        preview = "ó°‹— Question",

        title = true,
        icon = "ó°‹—",
      },
      ["HELP"] = {
        hl = "MarkviewBlockQuoteWarn",
        preview = "ó°‹— Help",

        title = true,
        icon = "ó°‹—",
      },
      ["FAQ"] = {
        hl = "MarkviewBlockQuoteWarn",
        preview = "ó°‹— Faq",

        title = true,
        icon = "ó°‹—",
      },
      ["FAILURE"] = {
        hl = "MarkviewBlockQuoteError",
        preview = "ó°…™ Failure",

        title = true,
        icon = "ó°…™",
      },
      ["FAIL"] = {
        hl = "MarkviewBlockQuoteError",
        preview = "ó°…™ Fail",

        title = true,
        icon = "ó°…™",
      },
      ["MISSING"] = {
        hl = "MarkviewBlockQuoteError",
        preview = "ó°…™ Missing",

        title = true,
        icon = "ó°…™",
      },
      ["DANGER"] = {
        hl = "MarkviewBlockQuoteError",
        preview = "ï­ Danger",

        title = true,
        icon = "ï­",
      },
      ["ERROR"] = {
        hl = "MarkviewBlockQuoteError",
        preview = "ï­ Error",

        title = true,
        icon = "ï­",
      },
      ["BUG"] = {
        hl = "MarkviewBlockQuoteError",
        preview = "ï‘¯ Bug",

        title = true,
        icon = "ï‘¯",
      },
      ["EXAMPLE"] = {
        hl = "MarkviewBlockQuoteSpecial",
        preview = "ó±–« Example",

        title = true,
        icon = "ó±–«",
      },
      ["QUOTE"] = {
        hl = "MarkviewBlockQuoteDefault",
        preview = "ï„ Quote",

        title = true,
        icon = "ï„",
      },
      ["CITE"] = {
        hl = "MarkviewBlockQuoteDefault",
        preview = "ï„ Cite",

        title = true,
        icon = "ï„",
      },
      ["HINT"] = {
        hl = "MarkviewBlockQuoteOk",
        preview = "ï€ Hint",

        title = true,
        icon = "ï„",
      },
      ["ATTENTION"] = {
        hl = "MarkviewBlockQuoteWarn",
        preview = "î©¬ Attention",

        title = true,
        icon = "ï„",
      },

      ["NOTE"] = {
        hl = "MarkviewBlockQuoteNote",
        preview = "ó°‹½ Note",

        title = true,
        icon = "ó°‹½",
      },
      ["TIP"] = {
        hl = "MarkviewBlockQuoteOk",
        preview = "ï€ Tip",

        title = true,
        icon = "ï€",
      },
      ["IMPORTANT"] = {
        hl = "MarkviewBlockQuoteSpecial",
        preview = "î­‚ Important",

        title = true,
        icon = "î­‚",
      },
      ["WARNING"] = {
        hl = "MarkviewBlockQuoteWarn",
        preview = "î©¬ Warning",

        title = true,
        icon = "î©¬",
      },
      ["CAUTION"] = {
        hl = "MarkviewBlockQuoteError",
        preview = "ó°³¦ Caution",

        title = true,
        icon = "ó°³¦",
      }
    },
```

## AstroNvim ä¸€å¯¡é è¨­ä¸ªè¨­å®šæª”

AstroNvim template ä½‡ lua/plugins é®ï¼Œä¼Šæœ‰ç•™ä¸€å¯¡ stubs äºˆå’±è£œæ·»ï¼Œ åƒ
none-ls.luaï¼Œå’±è‘—æª¢æŸ¥ä¼Šæ˜¯æ¯‹æ˜¯å…§å»ºå°±æœ‰å®‰è£çŸ£ï¼Œè‹¥æœ‰å®‰è£æ˜¯è¨­å•¥å…§å®¹ã€‚

## null-ls mystic error message

ä½‡ ~/.config/nvim ä»¥å¤–ä¸ªæ‰€åœ¨é–‹ lua æª”ï¼Œå®šå®šå‡ºç¾ç¥ç¥•ä¸ªéŒ¯èª¤è¨Šæ¯ï¼š

> [null-ls] failed to run generator: vim/shared.lua:0: s: expected string, got
> nil

Warp AI å…±æˆ‘æŸ¥æŸ¥å’§ï¼Œè¬›æ˜¯ selene å’§å’’è®–ï¼Œè‘—æ„›ä½‡å°ˆæ¡ˆæ ¹ç›®éŒ„éè¨­ selene.toml ä½®
vim.yml æª”äºˆ selene æ»¿æ„ã€‚æˆ‘çœ‹ ~/.config/nvim éæ˜¯è™Ÿåš selene.toml ä½®
neovim.ymlï¼Œ è€Œä¸”å…§å®¹æœ‰å‡ºå…¥ï¼Œä»Šåˆ—ä½‡ä¸‹åº•ï¼š

`~/.config/nvim/neovim.yml`:

```toml
---
base: lua51

globals:
  vim:
    any: true
```

`~/lua/vim.yml`

```yaml
---
globals:
  vim:
    any: true
  _G:
    any: true
```

`~/.config/nvim/selene.toml`

```toml
std = "neovim"

[rules]
global_usage = "allow"
if_same_then_else = "allow"
incorrect_standard_library_use = "allow"
mixed_table = "allow"
multiple_statements = "allow"
```

`~/lua/selene.toml`

```toml
std = "lua51+vim"
```

ä»Šä»¥ ~/.config/nvim ç‚ºæº–ï¼Œå°‡ selene.toml ä½® neovim.yml è¤‡è£½å» ~/.local/shareï¼Œ
è¼ƒè¢‚è¦‹æ“ºä½‡éæª¢è¦–æª”æ¡ˆæ”æœƒæ‹„è‘—è¿„ä¸ªgÃª-baÌkä¸ªéŒ¯èª¤ã€‚

## é‡æ•´ nvim config directories

å°‡ä¸€å¤§å †ç„¡å•¥ç”¨è‘—ä¸ª nvim distros æ”å¾™å» ~/lua/nvim-bk-20250812 åšå‚™ä»½ï¼š

> nvim nvim-lazyvim nvim-lsp nvim-nvchad nvim-nvchad2 nvim-old nvim-prac
> nvim-vim

ä»Šç•™ä»¥ä¸‹å¹¾ä¸ªä½‡ ~/.config/

> nvim nvim-as1 nvim-exo nvim-kickstart nvim-my

aliases ä¹Ÿè‘—ç¶´å’§æ•´ç†ã€‚

ç¸½è¬›ä¸€å¥ï¼Œ`nvim` æ˜¯æœ‰éè¨­å®šé–£æ¸…æ°£ä¸ªç’°å¢ƒï¼Œ`nvim-as1` (aliased `nv`) æ˜¯å¯¦é©—å“ï¼Œ
å…¶ä»–ä¸ªæ˜¯åƒè€ƒç”¨ã€‚

## å®‰è£è¨­å®š Markdown-oxide

ç°¡å–®èª¿æŸ¥ä¸€ä¸‹ï¼Œæ¬²ä¾†è©¦ç”¨ Markdown-oxideï¼Œé€™æ˜¯ PKM (Personal Knowledge Management)
ä¸ªå·¥å…·ã€‚

### Warp AI è¨ˆç•«æ›¸

---
1. Create plugins/markdown-oxide.lua spec
Add a new Lazy-spec file (e.g. lua/plugins/markdown-oxide.lua) that:
  â€¢ Declares dependency on "lukas-reineke/headlines.nvim" (optional) and "nvim-treesitter/nvim-treesitter".
  â€¢ Adds "markdown-oxide" to Mason's ensure_installed list.
  â€¢ Registers the lsp server by extending `require("astrolsp").config` to include:
```lua
config = {
  ["markdown_oxide"] = {
    settings = {
      markdown = {
        folding = {
          rangeLimit = 5000,
          enable = true,
        },
      },
    },
    capabilities = {
      textDocument = {
        foldingRange = { dynamicRegistration = false, lineFoldingOnly = true },
      },
    },
  },
},
servers = { "markdown_oxide" },
```
2. Install & configure Treesitter parsers for markdown
Create plugins/treesitter-markdown.lua (or extend existing treesitter spec) with:
```lua
return {
  "nvim-treesitter/nvim-treesitter",
  opts = function(_, opts)
    opts.ensure_installed = vim.tbl_extend("force", opts.ensure_installed or {}, { "markdown", "markdown_inline" })
    opts.highlight.disable = opts.highlight.disable or {}
  end,
}
```
Add markdownâ€specific foldexpr:
```lua
vim.api.nvim_create_autocmd("FileType", {
  pattern = "markdown",
  callback = function()
    vim.wo.foldmethod = "expr"
    vim.wo.foldexpr = "nvim_treesitter#foldexpr()"
  end,
})
```
3. Wire folding sources together
Within plugins/markdown-oxide.lua `on_attach` for markdown-oxide, prefer LSP if available:
```lua
on_attach = function(client, bufnr)
  if client.server_capabilities.foldingRangeProvider then
    vim.b[bufnr].lsp_folds = true
    vim.wo.foldmethod = "manual"
    vim.wo.foldexpr = ""
  end
end
```
Add fallback autocmd so if `b:lsp_folds` is nil we keep treesitter folds.
4. Add markdown-specific key-mappings
In plugins/markdown-oxide.lua, inside `mappings = { n = { â€¦ } }` add:
  â€¢ `<leader>mf` â†’ `:lua vim.lsp.buf.execute_command({ command = "markdown-oxide.followLink" })<CR>`
  â€¢ `<leader>mo` â†’ `:lua vim.lsp.buf.execute_command({ command = "markdown-oxide.openLink" })<CR>`
  â€¢ `<leader>md` â†’ `:lua vim.lsp.buf.execute_command({ command = "markdown-oxide.openDaily" })<CR>`
  â€¢ `<leader>mn` â†’ `:lua vim.lsp.buf.execute_command({ command = "markdown-oxide.createNoteFromSelection" })<CR>`
Each mapping is wrapped in `cond = function(client) return client.name == "markdown_oxide" end`.
5. Ensure seamless integration with markview.nvim
Inside the same spec, add buffer-local command:

```lua
vim.api.nvim_create_autocmd("FileType", {
  pattern = "markdown",
  callback = function()
    -- open preview with <leader>mp
    vim.keymap.set("n", "<leader>mp", ":MarkviewOpen<CR>", { buffer = true, desc = "Open Markview preview" })
  end,
})
```
Also set `vim.g.markview_theme_sync = true` to share Catppuccin theme.
6. Document and reload

Update README or personal notes with new key-maps; run `:Lazy sync` then `:Mason`
to verify **markdown-oxide** is installed.  Open a markdown file to test folding
and link navigation.
---

### å¯¦éš›è¨­å®šåšè¦æ™¡ä¹…

ç¨‹å¼ä¸€ç›´æœ‰ bugï¼Œæœ€å¾Œæ‰å‹‰å¼·å‰µå¥½ï¼Œç¸½æ˜¯æˆæœé–£è¢‚ä†€ï¼Œfolding åŠ çœŸæ­£å¸¸çŸ£ï¼

## markdown-oxide è¨­å®šéç¨‹ä¸­ï¼Œæ–°å¢ã€æ”¹å‹•ä¸ªæª”æ¡ˆ

### ğŸ“‹ Summary of File Changes

#### ğŸ†• **New Files Created:**

1. **`lua/plugins/markdown-oxide.lua`**

- Configures Mason to install markdown-oxide
- Adds Treesitter and headlines.nvim dependencies
- Simple configuration file for package management

2. **`lua/plugins/treesitter-markdown.lua`**

- Ensures markdown and markdown_inline parsers are installed
- Sets up Treesitter-based folding for markdown files
- Includes fallback logic to only use Treesitter folding when LSP folding isn't
  available

3. **`lua/debug_lsp.lua`**

- Debug utility for tracking LSP client lifecycle
- Helped identify the semantic tokens issue
- Can be re-enabled by uncommenting in polish.lua if needed

4. **`test_markdown_features.md`**

- Test file with various markdown elements
- Used for testing folding, links, and other features
- Can be deleted if no longer needed

#### âœï¸ **Modified Files:**

1. **`lua/plugins/astrolsp.lua`**

- Added markdown_oxide to servers list
- Added complete markdown_oxide configuration with:
  - Disabled semantic tokens to fix "No client with id 1" error
  - Folding support configuration
  - Custom key mappings for markdown operations
- Added mappings in both normal and visual modes

2. **`lua/plugins/markview.lua`**

- Added `config` function to set theme sync (`vim.g.markview_theme_sync = true`)
- Added autocmd for `<Leader>mp` keymap to open Markview preview
- Integrated with Catppuccin theme

3. **`lua/community.lua`**

- Kept markview-nvim import enabled (required to prevent runtime path errors)
- No net changes from original

4. **`lua/polish.lua`**

- Enabled (uncommented the first line)
- Added debug_lsp require (currently commented out)
- Can be used for post-setup configurations

5. **`README.md`**

- Added comprehensive documentation of all custom key mappings
- Documented markdown-oxide features and commands
- Added installation verification steps

### ğŸ”‘ **Key Configuration Changes:**

**In `astrolsp.lua`:**

```lua
-- Critical fix for the LSP error:
client.server_capabilities.semanticTokensProvider = nil

-- Folding configuration:
if client.server_capabilities.foldingRangeProvider then
  vim.b[bufnr].lsp_folds = true
  vim.wo.foldmethod = "manual"
  vim.wo.foldexpr = ""
end
```

**In `markview.lua`:**

```lua
-- Theme synchronization:
vim.g.markview_theme_sync = true
-- Buffer-local keymap:
vim.keymap.set("n", "<leader>mp", ":MarkviewOpen<CR>",
               { buffer = true, desc = "Open Markview preview" })
```

### ğŸ“ **Files You Should Review:**

1. **`lua/plugins/astrolsp.lua`** - Main LSP configuration with all markdown
   features
2. **`lua/plugins/markview.lua`** - Visual markdown enhancements
3. **`lua/plugins/treesitter-markdown.lua`** - Fallback folding configuration
4. **`lua/plugins/markdown-oxide.lua`** - Package installation configuration

These files contain all the core functionality for your enhanced markdown
editing setup.

## nvim-ts-autotag é‡å° markdown é—œèµ·ä¾†

è¨­å¥½ä½‡ [ts-autotag.lua](~/.config/nvim/lua/plugins/ts-autotag.lua)
