# 2025-09-16 學習日誌

- [ ] typst for CJK
- [x] `.luarc.json` vs. `.luacheckrc`
- [x] typst + rubby package 進行台語文排版

閬真久無學習。Warp 閣繼續咧出新功能。

十幾日前開始咧學 typst，學一屑仔就停睏矣。

## `typst` for CJk

USER:
Does `typst` typesetting system fully support CJK processing?

AGENT:
Yes, Typst has robust built-in support for CJK (Chinese, Japanese, Korean) text processing. Here are the key features:

### CJK Typography Support

**Line Breaking**: Typst automatically handles CJK line breaking rules, including:

- Proper character-based line breaking (no spaces needed between CJK characters)
- Prohibition rules (avoiding line breaks before/after certain punctuation)
- Support for mixed CJK and Latin text

**Font Handling**:

- Automatic font fallback for CJK characters
- Support for CJK fonts through system fonts
- Can specify different fonts for different scripts

**Text Direction**:

- Horizontal text layout (default)
- Vertical text layout support for traditional CJK typography using
  `#set text(dir: ttb)` (top-to-bottom)

**Language-Specific Features**:

- Language tagging with `#set text(lang: "zh")`, `#set text(lang: "ja")`, or `#set text(lang: "ko")`
- Proper spacing and punctuation handling for each language
- Ruby text support for Japanese (furigana) and Chinese (pinyin annotations)

### Example Usage

```typst
#set text(lang: "zh", font: "Noto Sans CJK SC")

// Chinese text with proper line breaking
这是一段中文文本，Typst会自动处理换行。

// Japanese with ruby annotations
#ruby("東京", "とうきょう")へ行きます。

// Mixed CJK and English
这是mixed text混合文本example。
```

### Limitations

While Typst's CJK support is quite comprehensive, a few advanced features are
still being developed:

- Some complex vertical text layouts might need manual adjustments
- Certain traditional typography features (like some classical Chinese
  formatting) may require workarounds

Overall, Typst provides excellent out-of-the-box CJK support that handles most
common use cases without requiring external packages or complex configuration,
making it a strong choice for multilingual documents.

USER:
In a `typ` file, how to set the title?

AGENT:
In Typst, there are several ways to set a title depending on your needs:

### Method 1: Simple Title with Heading

```typst
= My Document Title

This is the document content...
```

### Method 2: Using `set document` for Metadata

```typst
#set document(title: "My Document Title", author: "Your Name")

= My Document Title

This is the document content...
```

### Method 3: Custom Title Page

```typst
#align(center)[
  #text(size: 24pt, weight: "bold")[
    My Document Title
  ]

  #v(1em)

  #text(size: 14pt)[
    Author Name
  ]

  #v(1em)

  #text(size: 12pt)[
    #datetime.today().display()
  ]
]

#pagebreak()

// Document content starts here
```

### Method 4: Using Variables for Reusability

```typst
#let title = "My Document Title"
#let author = "Your Name"

#set document(title: title, author: author)

#align(center)[
  #text(size: 24pt, weight: "bold")[#title]

  #v(1em)

  #text(size: 14pt)[#author]
]
```

### For CJK Documents

Based on your selected text, if you're working with Chinese documents:

```typst
#set text(lang: "zh", font: "Noto Sans CJK SC")
#set document(title: "文档标题", author: "作者姓名")

= 文档标题

这是文档内容...
```

The `#set document()` method is particularly useful because it sets the PDF
metadata (visible in PDF readers' properties), while the visual title on the
page can be styled separately using headings or custom formatting.

USER:
My documents are a mixture of Chinese characters, Taiwanese Romanization
alphabets with many diacritical marks and English words all encoded in UTF-8.
What are appropriate arguments for the `#set text()` function?

AGENT:
For documents mixing Chinese characters, Taiwanese Romanization (Pe̍h-ōe-jī/POJ
or Tâi-lô), and English, here are the recommended `#set text()` arguments:

### Recommended Settings

```typst
#set text(
  lang: "zh-TW",  // or "zh-Hant" for Traditional Chinese
  font: (
    "Noto Sans CJK TC",  // Primary font for Chinese
    "Noto Sans",         // Fallback for Latin with diacritics
    "DejaVu Sans",       // Additional fallback
    "Arial Unicode MS",  // Wide Unicode coverage
  ),
  size: 11pt,
  fallback: true,  // Enable automatic font fallback
)
```

### Key Considerations

**Language Tag**:

- Use `"zh-TW"` for Taiwan Chinese
- Or `"zh-Hant"` for Traditional Chinese script
- This affects line breaking and typography rules

**Font Selection**:
Fonts that handle both CJK and diacritical marks well:

1. **Noto Sans CJK TC** - Excellent for Traditional Chinese
2. **Source Han Sans TC** - Adobe's open-source alternative
3. **PingFang TC** - macOS system font
4. **Microsoft JhengHei** - Windows font with good diacritic support

**Testing Diacritical Marks**:

```typst
#set text(
  lang: "zh-TW",
  font: ("Noto Sans CJK TC", "Noto Sans"),
)

// Test Taiwanese Romanization
Pe̍h-ōe-jī: Tâi-oân-ōe
Tâi-lô: Tâi-uân-uē
臺灣話 / 台灣話

// Tone marks test
a á à â ǎ ā a̍ a̋
e é è ê ě ē e̍ e̋
o ó ò ô ǒ ō o̍ ő
```

### Alternative for Better Diacritic Handling

If you experience issues with tone marks, you can use separate font settings
for different content:

```typst
#set text(lang: "zh-TW", font: "Noto Sans CJK TC")

// For Romanized text sections
#let poj(content) = text(font: ("Gentium Plus", "Charis SIL", "Noto Sans"), content)

// Usage
臺灣話： #poj[Tâi-oân-ōe] 是台灣的語言。
```

**Note**: Fonts like **Gentium Plus** and **Charis SIL** are specifically
designed for linguistic typography and handle complex diacritics exceptionally
well.

### Verification

To check if your chosen fonts support all needed characters:

```typst
#set text(font: ("Your Font Choice",))

// Test all common POJ/Tâi-lô diacritics
Vowels with tones: á à â ǎ ā a̍ a̋
Nasal mark: o͘ (o with dot above right)
Special: ⁿ (superscript n) m̄ (m with macron)
```

The key is using fonts with comprehensive Unicode support and enabling fallback
to ensure all characters render correctly.

## typst + rubby package 進行台語文排版

rubby package 無法度正確處理 `--`，愛用 `#text()` 包起來：

### Warp AI 處理結果

The issue was that the rubby package couldn't handle the literal -- (double
hyphen) in the ruby text. When Typst encounters -- in certain contexts, it may
interpret it as special syntax rather than literal text.

The solution is to wrap the text containing double hyphens in the #text() function:

- Before: `#tw[--buē][未]` (causes error)
- After: `#tw[#text("--buē")][未]` (works correctly)

This tells Typst to treat the content as literal text, preventing any special
interpretation of the double hyphens. The visual output still shows the double
hyphens correctly for the Taiwanese neutral tone marker.

Other working alternatives include:
• Using Unicode dashes like em dash — or en dash – (though these look different)
• Using #raw("--buē") (displays in monospace font)
• Using string concatenation #("-" + "-buē") (more verbose)

The #text() solution is the cleanest and preserves the intended appearance of
the double hyphen for Taiwanese romanization.
