# 2025-08-10 學習日誌

- [x] debug `<leader>lf` for visual mode
- [x] install and use markdownlint-cli2
- [x] prettier CJK 袂拗逝个問題
- [ ] Undefined type or alias `LazySpec` / `AstroLSPOpts`

睏前感想，astrodark theme 用佇 markdown 其實真好，事久見好物。

## `<leader>lf` debugging

總算處理以下个問題：

1. `gq`/`gqq` 原指令予崁過，恢復轉來矣。閣設獨立个 `<leader>lF` 來用。

2. V mode `<leader>lf` 無效：佇 md，改做無論 n / v 攏作用佇全buffer，講是
   prettier 未解个bug；佇 lua，改予真正會使針對 selection。

### AI Summary of Solutions

Excellent! I'm glad everything is working as expected now. Let me summarize what
we've accomplished:

#### 1. **Visual Mode Formatting Fix (`fix-visual-mode-format.lua`)**

- Fixed the issue where visual mode `<Leader>lf` wasn't working for any file
  type
- Replaced AstroNvim's default LSP formatting with conform.nvim for both normal
  and visual modes
- Now works consistently across all file types (Lua, markdown, etc.)

#### 2. **Native Vim `gq` Restoration (`restore-gq-markdown.lua`)**

- Restored native Vim `gq` command for markdown files
- Properly handles CJK text formatting
- Added `<Leader>lF` as an alternative to format entire buffer with native Vim
- Clears `formatexpr` and `formatprg` to prevent interference

#### 3. **Prettier Configuration for Markdown**

- Configured prettier/prettierd with `--prose-wrap always` for markdown files
- Noted the limitation: prettier's range formatting doesn't work well with prose
  wrapping (this is a prettier bug)

### Key Mappings Now Available

#### For All File Types

- **`<Leader>lf` (normal mode)**: Format entire buffer using conform.nvim
- **`<Leader>lf` (visual mode)**: Format selected range using conform.nvim

#### For Markdown Files

- **`gq` (normal/visual mode)**: Native Vim formatting (CJK-aware)
- **`gqp`**: Format paragraph with native Vim
- **`<Leader>lF`**: Format entire buffer with native Vim formatting

The solution elegantly handles the complex interaction between:

- AstroNvim's LSP configuration
- conform.nvim formatter
- Native Vim formatting
- Prettier's markdown formatting limitations

Everything is now working harmoniously!

---

## markdownlint-cli2

### markdownlint-cli2 as CLI tool

這是 CLI tool，也會使得予 Neovim 用。

**installatioan:**

```shell
npm install -g markdownlint-cli2
```

**usage:**

```shell
markdownlint-cli2 "**/*.md"       # lint all markdown files recursively
markdownlint-cli2 README.md       # lint a specific file
markdownlint-cli2 --fix "**/*.md" # automatically fix issues where possible
```

Warp AI has created `~/.markdownlint.yaml` for me. Reading it will learn good
style for writing markdown.

### markdownlint-cli2 as Neovim plugin

`lua/plugins/non-ls.lua` 加一行 `null_ls.builtins.diagnostics.markdownlint_cli2,`
頭前愛會記得扑開 `local null_ls = require "null-ls"` 若無，會有 undefined global
`null_ls` 个錯誤。

利用佮頭前 CLI tool 仝款个 `~/.markdownlint.yaml` 設定檔就可以。

#### markdownlint-cli2 毋是 server

無法度即時檢視編修中个 buffer 內容，著愛 `:w` 了後伊才會閣重檢查。

## prettier CJK 袂拗逝个問題

本底我掠叫是 prettier 是毋捌漢字處理个西洋儂寫个，其實是精通即个議題个日本儂，
伊佇新版个 prettier 才決定無愛閣拗逝漢字，因為拗落去到塊，轉做 html 了後，
佇瀏覽器像 Chrome / Safari 就會佇漢字中間加出歹看个空格（Firefox 佇即點有守 CSS
規範，無即種問題）。橫直漢字是我家己扑个，本來就盡量袂傷長，而且我會盡量揣標點
抑是英文單字後來拗逝，閣較䆀个情形就是像頂挺按呢佇漢字斷詞點拗逝。

但是將 `proseWrap` 設做 "always"，結果伊顛倒煞共我个多行漢字 kap 做一行，
按呢做就過頭去矣。補充：想想咧也是合理，伊是佇英文佮漢字交界个所在拗逝，
紲落來个漢字合做一逝。

### prettier config temp solution

暫且將 `"proseWrap" = "preserve"`，就是叫伊勿tshap即方面个排版，這我才叫 nvim
本身个 gq/gqq 來做就好，抑其他个排版細節才交予 prettier 做。
