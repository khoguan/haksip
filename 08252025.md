# 2025-08-25 學習日誌

- [x] nvim-lint 原理
- [x] 用 nvim-lint 管理 markdownlint 佮 luacheck linters
- [x] keymaps for toggle relativenumber & copy full file path

## nvim-lint 原理

nvim-lint 就是一種 linters manager，伊會使針對無仝个源碼類型設置無仝个 linters：
發動 linter 去檢查 nvim session 中个源碼，讀取 linter 个執行結果，透過
vim.diagnostic 模組 傳轉來 nvim session 中，佮 buffer 个內容同齊顯示出來予使用者
知影源碼个佗位仔可能寫了無拄好。

nvim-lint 說明書个一寡要點

1. nvim-lint complements the built-in language server client for languages
   where there are no language servers, or where standalone linters provide
   better results.

2. Some linters require a file to be saved to disk, others support linting stdin
   input. For the latter linters you could also define a more aggressive
   autocmd, for example on the InsertLeave or TextChanged events.

3. If you want to customize how the diagnostics are displayed, read :help
   vim.diagnostic.config.

## 用 nvim-lint 來管理 markdownlint

有做便个 community.lsp.nvim-lint thang好用，匯入了後，閣佇 plugins/markdown.lua
當中兩个所在指定就好勢：

1. mason-tool-installer 將 markdownlint 加入來，按呢就會自動安裝程式本身。
2. 閣佇 nvim-lint 遐簡單指定 linters_by_ft:

   ```lua
   {
     "mfussenegger/nvim-lint",
     optional = true,
     opts = {
       linters_by_ft = {
         markdown = { "markdownlint" },
       },
     },
   },
   ```

   linter 較單純，予伊常駐來檢查就好，毋免像 formatter 著愛設一个 keymap
   較方便操作。

## 用 mason-null-ls 來管理 Markdown dprint formatter

community.pack.markdown 佇 mason-null-ls 遐指定 ensure_installed 愛包含 dprint，
閣用 mason-tool-installer 來確保安裝了後，佇 AstroNvim 系統下底就會用得矣。
總是上好著配合 dprint.json config file.

AstroNvim 本底就有設 `<leader>lf` 來 format buffer：

```lua
    maps.n["<Leader>lf"] = {
      function() vim.lsp.buf.format(require("astrolsp").format_opts) end,
      desc = "Format buffer",
      cond = formatting_enabled,
    }
    maps.v["<Leader>lf"] = {
      function() vim.lsp.buf.format(require("astrolsp").format_opts) end,
      desc = "Format buffer",
      cond = formatting_checker "rangeFormatting",
    }
```

其中个 vim.lsp.buf.format() 函式真巧个款，大概是若有專門个 formatter，伊就用
專門个 formatter 來 format buffer，但是若無--者，伊就 fallback 轉去用 LSP。

目前 v mode 下底个 format selection 攏試袂成功，伊直接 format 規个 buffer。

## Lua linter & formatter

1. Lua linter 若選用 luacheck，配合 nvim-lint，佮頭前 markdownlint
个設定法一模一樣。

2. Lua formatter 若用 community.pack.lua 預設个 stylua，伊就是用 mason-null-ls
   來指定，用 mason-tool-installer 確保自動安裝，按呢就好勢。

進前我了遐濟精神去叫 AI 來鬥解決，主要个問題是無法度 range formatting，伊才著
想空想縫一直改程式。若無，欲 format 全部 buffer 親像桌頂拈柑咧！

## AstroNvim 下，mason-null-ls vs. nvim-lint

用 mason-null-ls 佮用 nvim-lint 佇 AstroNvim 環境來講，前者是預設就有安裝運轉，
ensure_installed 有包含咱欲愛个 formatter 就好。若欲改用 nvim-lint，就佇
community.lua 遐加一行，閣佇 plugins 下底設一个 lua 檔，簡單指定 linters_by_ft。
兩種方式最後攏閣創一个彼个 linter 專用个 config file 佇專案根目錄遐做指示。
按呢就完成。

我本底想講 AstroNvim 已經足完備矣，哪會遮歹設定，彼是因為有寡我真掛意个功能
目前社群猶未做甲周至，毋是 AstroNvim 整合了無好个問題。

## 多語言个 formatter 像 prettierd，mason-null-ls 按怎指定？

我看 community.pack.markdown 个做法，佇 mason-null-ls 遐也是指定
ensure_installed 愛包含 prettierd 爾爾，無閣進一步講這是欲予 MD 使用个
formatter。不而過，伊下底有加一个 `conform.nvim` LazySpec，就會使指定
formatters_by_ft，但是因為伊是 optional，進前我無特別加裝 conform，
毋過進入 MD 檔个時，猶原看會著 prettierd 列佇狀態列。

## keymaps for toggle relativenumber & copy full file path

1. 模仿 _astrocore_mappings 个寫法，設一个 `<Leader>ur` to toggle relativenumber
有 notification popup，較有專業感……。

2. `<Leader>bf`  
   `function() vim.fn.setreg("+", vim.fn.expand "%:p") end,`

